<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Email Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0d1117;
            font-family: 'Inter', sans-serif;
        }
        .screen {
            display: none;
            min-height: 100vh;
        }
        .screen.active {
            display: flex;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: none;
            z-index: 50;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        /* Add this to your <style> section */

/* Mobile Responsive Styles */
@media (max-width: 768px) {
    /* Main app layout - stack vertically */
    #main-app-screen .flex {
        flex-direction: column;
    }
    
    /* Sidebar takes full width on mobile */
    #main-app-screen .w-1\/4 {
        width: 100%;
        min-width: unset;
        max-height: 40vh;
        border-right: none;
        border-bottom: 2px solid #374151;
    }
    
    /* Email viewer takes remaining space */
    #main-app-screen .flex-grow {
        padding: 1rem;
    }
    
    /* Welcome screen - reduce padding */
    #welcome-screen {
        padding: 2rem 1rem;
    }
    
    /* Welcome screen heading */
    #welcome-screen h1 {
        font-size: 2rem;
    }
    
    #welcome-screen p {
        font-size: 1rem;
    }
    
    /* Feature grid - 2 columns instead of 4 */
    #welcome-screen .grid-cols-4 {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    /* How it works - single column */
    .grid-cols-3 {
        grid-template-columns: 1fr;
    }
    
    /* Privacy section - single column */
    .grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    /* Buttons - stack vertically */
    #welcome-screen .flex.gap-4 {
        flex-direction: column;
        width: 100%;
    }
    
    #welcome-screen .flex.gap-4 button {
        width: 100%;
    }
    
    /* Modal - full width on mobile */
    .modal-overlay > div {
        width: 95%;
        max-width: 95%;
        margin: 1rem;
    }
    
    /* Email viewer content */
    #email-viewer-container h2 {
        font-size: 1.5rem;
    }
    
    /* Analysis grid - single column */
    #email-viewer-container .grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    /* API setup screen */
    #api-setup-screen .max-w-2xl,
    #privacy-screen .max-w-3xl,
    #gmail-connect-screen .max-w-xl,
    #customization-screen .max-w-xl {
        width: 95%;
        padding: 1.5rem;
    }
    
    /* Privacy screen buttons */
    #privacy-screen .flex.justify-between,
    #api-setup-screen .flex.justify-between,
    #customization-screen .flex.justify-between {
        flex-direction: column;
        gap: 1rem;
    }
    
    #privacy-screen .flex.justify-between button,
    #api-setup-screen .flex.justify-between button,
    #customization-screen .flex.justify-between button {
        width: 100%;
    }
    
    /* Email list items - better touch targets */
    #email-list-container > div {
        padding: 1rem;
    }
    
    /* Text sizing adjustments */
    .text-5xl {
        font-size: 2.5rem;
    }
    
    .text-3xl {
        font-size: 1.75rem;
    }
}
/* Theme Variables */
:root {
    --bg-primary: #0d1117;
    --bg-secondary: #161b22;
    --bg-tertiary: #1f2937;
    --text-primary: #ffffff;
    --text-secondary: #9ca3af;
    --border-color: #374151;
    --accent-color: #3b82f6;
}

body.light-mode {
    --bg-primary: #ffffff;
    --bg-secondary: #f3f4f6;
    --bg-tertiary: #e5e7eb;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --border-color: #d1d5db;
    --accent-color: #2563eb;
}

/* Apply variables to elements */
body {
    background-color: var(--bg-primary);
    color: var(--text-primary);
}

.bg-gray-900 {
    background-color: var(--bg-secondary) !important;
}

.bg-gray-800 {
    background-color: var(--bg-tertiary) !important;
}

.bg-gray-700 {
    background-color: var(--bg-tertiary) !important;
}

.text-gray-400 {
    color: var(--text-secondary) !important;
}

.text-gray-300 {
    color: var(--text-secondary) !important;
}

.border-gray-700 {
    border-color: var(--border-color) !important;
}

.border-gray-600 {
    border-color: var(--border-color) !important;
}

/* Light mode specific adjustments */
body.light-mode .text-white {
    color: var(--text-primary) !important;
}

body.light-mode .bg-gray-600 {
    background-color: #9ca3af !important;
}

body.light-mode .hover\:bg-gray-700:hover {
    background-color: #e5e7eb !important;
}

body.light-mode .hover\:bg-gray-600:hover {
    background-color: #f3f4f6 !important;
}

body.light-mode .hover\:bg-gray-500:hover {
    background-color: #e5e7eb !important;
}

/* Theme toggle button styles */
.theme-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    z-index: 1000;
}

.theme-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

.theme-toggle:active {
    transform: scale(0.95);
}

body.light-mode .theme-toggle {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}
/* Small mobile devices */
@media (max-width: 480px) {
    /* Further reduce text sizes */
    #welcome-screen h1 {
        font-size: 1.75rem;
    }
    
    #welcome-screen .text-xl {
        font-size: 1rem;
    }
    
    /* Single column for feature grid */
    #welcome-screen .grid-cols-4,
    #welcome-screen .grid-cols-2 {
        grid-template-columns: 1fr;
    }
    
    /* Smaller buttons */
    button {
        padding: 0.75rem 1.5rem;
        font-size: 0.875rem;
    }
    
    /* Email sidebar - smaller height */
    #main-app-screen .w-1\/4 {
        max-height: 35vh;
    }
}

/* Landscape mobile orientation */
@media (max-width: 768px) and (orientation: landscape) {
    #main-app-screen .flex {
        flex-direction: row;
    }
    
    #main-app-screen .w-1\/4 {
        width: 40%;
        max-height: 100vh;
        border-right: 2px solid #374151;
        border-bottom: none;
    }
}
    </style>
</head>
<body class="text-white">
    <script src="https://accounts.google.com/gsi/client" async defer>
        // Theme Toggle Function
function toggleTheme() {
    const body = document.body;
    const currentTheme = body.classList.contains('light-mode') ? 'light' : 'dark';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    if (newTheme === 'light') {
        body.classList.add('light-mode');
    } else {
        body.classList.remove('light-mode');
    }
    
    // Save preference
    localStorage.setItem('theme', newTheme);
    
    // Update button emoji
    updateThemeButton();
}

function updateThemeButton() {
    const button = document.getElementById('theme-toggle-btn');
    if (button) {
        const isLight = document.body.classList.contains('light-mode');
        button.textContent = isLight ? '🌙' : '☀️';
    }
}

// Load saved theme on page load
function loadSavedTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
    }
    updateThemeButton();
}

// Update your existing DOMContentLoaded event
document.addEventListener('DOMContentLoaded', () => {
    const savedClientId = localStorage.getItem('gmail_client_id');
    const savedGeminiKey = localStorage.getItem('gemini_api_key');
    
    if (savedClientId && savedGeminiKey) {
        CLIENT_ID = savedClientId;
        GEMINI_API_KEY = savedGeminiKey;
        document.getElementById('client-id-input').value = savedClientId;
        document.getElementById('gemini-key-input').value = savedGeminiKey;
    }
    
    // Load theme
    loadSavedTheme();
    
    showScreen('welcome-screen');
});
    </script>
    <script>
        let emails = [];
        let selectedEmail = null;
        let userInterests = '';
        let userSchedule = '';
        
        // NEW: Gmail & Gemini API Configuration
        let CLIENT_ID = '';
        let GEMINI_API_KEY = '';
        let tokenClient;
        let accessToken = null;
        let useRealAPI = false;

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startCustomization() {
            showScreen('customization-screen');
        }

        function continueToInbox() {
            userInterests = document.getElementById('interests').value;
            userSchedule = document.getElementById('schedule').value;
            showScreen('main-app-screen');
            renderEmails();
        }

        // NEW: Setup API Configuration
        function setupAPIs() {
            showScreen('api-setup-screen');
        }

        let fetchMode = 'safe'; // Default to safe mode
        let sensitiveKeywords = ['otp', 'verification code', 'bank', 'password', 'reset password', 'account verification', 'security code', 'two-factor', '2fa', 'confirm your', 'verify your account'];

        function saveAPIConfig() {
            const clientId = document.getElementById('client-id-input').value.trim();
            const geminiKey = document.getElementById('gemini-key-input').value.trim();
            
            if (!clientId || !geminiKey) {
                alert('Please enter both API credentials');
                return;
            }
            
            CLIENT_ID = clientId;
            GEMINI_API_KEY = geminiKey;
            useRealAPI = true;
            
            // Save to localStorage (optional)
            localStorage.setItem('gmail_client_id', clientId);
            localStorage.setItem('gemini_api_key', geminiKey);
            
            initializeGoogleAuth();
            showScreen('privacy-screen');
        }

        function acceptPrivacyAndConnect() {
            // Get selected fetch mode
            const selectedMode = document.querySelector('input[name="fetch-mode"]:checked').value;
            fetchMode = selectedMode;
            localStorage.setItem('fetch_mode', fetchMode);
            showScreen('gmail-connect-screen');
        }

        function isSensitiveEmail(subject, snippet) {
            if (fetchMode === 'manual') return false; // Don't filter in manual mode
            
            const text = (subject + ' ' + snippet).toLowerCase();
            
            // Check for sensitive keywords
            for (let keyword of sensitiveKeywords) {
                if (text.includes(keyword)) {
                    return true;
                }
            }
            
            // Check for work mode
            if (fetchMode === 'work') {
                // Simple heuristic: if contains personal indicators, skip
                const personalIndicators = ['friend', 'family', 'personal', 'shopping', 'order'];
                for (let indicator of personalIndicators) {
                    if (text.includes(indicator)) return true;
                }
            }
            
            return false;
        }

        function skipAPISetup() {
            useRealAPI = false;
            showScreen('main-app-screen');
            renderEmails();
        }

        // NEW: Initialize Google OAuth
        function initializeGoogleAuth() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/gmail.readonly',
                callback: (response) => {
                    if (response.access_token) {
                        accessToken = response.access_token;
                        showScreen('main-app-screen');
                        loadGmailEmails();
                    }
                },
            });
        }

        // NEW: Connect Gmail
        function connectGmail() {
            if (tokenClient) {
                tokenClient.requestAccessToken();
                document.getElementById('api-status').textContent = 'Connected - Gmail + AI';
                document.getElementById('privacy-badge').style.display = 'block';
            }
        }

        // NEW: Load emails from Gmail API
        async function loadGmailEmails() {
            try {
                let query = 'in:inbox';
                
                // Apply filters based on fetch mode
                if (fetchMode === 'safe') {
                    query += ' -subject:otp -subject:verification -subject:password -subject:bank';
                } else if (fetchMode === 'work') {
                    query += ' -subject:order -subject:shopping -subject:personal';
                }
                
                const response = await fetch(`https://www.googleapis.com/gmail/v1/users/me/messages?maxResults=20&q=${encodeURIComponent(query)}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.messages) {
                    const emailPromises = data.messages.map(msg => getGmailEmailDetails(msg.id));
                    const gmailEmails = await Promise.all(emailPromises);
                    
                    // Add to emails array (filter sensitive)
                    gmailEmails.forEach(email => {
                        if (email && !isSensitiveEmail(email.subject, email.body.substring(0, 200))) {
                            emails.push(email);
                        }
                    });
                    
                    emails.sort((a, b) => b.analysis.priorityScore - a.analysis.priorityScore);
                    renderEmails();
                }
            } catch (error) {
                console.error('Failed to load Gmail emails:', error);
                alert('Failed to load emails from Gmail. Please try again.');
            }
        }

        // NEW: Get Gmail email details
        async function getGmailEmailDetails(messageId) {
            try {
                const response = await fetch(`https://www.googleapis.com/gmail/v1/users/me/messages/${messageId}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                const email = await response.json();
                const headers = email.payload.headers;
                
                const from = headers.find(h => h.name === 'From')?.value || 'Unknown';
                const subject = headers.find(h => h.name === 'Subject')?.value || 'No Subject';
                const date = new Date(parseInt(email.internalDate)).toLocaleTimeString();
                const snippet = email.snippet || '';
                
                // Get body
                let body = snippet;
                if (email.payload.body && email.payload.body.data) {
                    body = atob(email.payload.body.data.replace(/-/g, '+').replace(/_/g, '/'));
                }
                
                // Analyze with AI (Gemini or fallback)
                const analysis = await analyzeEmailWithAI(subject, body, from);
                
                return {
                    id: email.id,
                    from: from,
                    subject: subject,
                    body: body,
                    received: date,
                    analysis: analysis
                };
            } catch (error) {
                console.error('Error fetching email details:', error);
                return null;
            }
        }

        // NEW: Analyze email with Gemini AI
        async function analyzeEmailWithAI(subject, body, from) {
            if (!useRealAPI || !GEMINI_API_KEY) {
                // Fallback to local analysis
                return {
                    priorityScore: analyzePriority(subject, body),
                    mood: analyzeMood(subject + ' ' + body),
                    summary: body.substring(0, 100) + '...',
                    draftResponse: generateResponse(subject, body)
                };
            }

            try {
                const prompt = `Analyze this email and provide:
1. Priority level (1-10 number)
2. Mood (Stressed/Happy/Concerned/Neutral/Formal)
3. Brief summary (one sentence, max 100 chars)
4. Professional response draft

Email:
From: ${from}
Subject: ${subject}
Body: ${body.substring(0, 500)}

Respond in JSON format:
{
  "priorityScore": number,
  "mood": "mood",
  "summary": "summary",
  "draftResponse": "response"
}`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                
                // Extract JSON from response
                const jsonMatch = aiText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const parsed = JSON.parse(jsonMatch[0]);
                    return {
                        priorityScore: Math.min(Math.max(parsed.priorityScore || 5, 1), 10),
                        mood: parsed.mood || 'Neutral',
                        summary: parsed.summary || body.substring(0, 100) + '...',
                        draftResponse: parsed.draftResponse || generateResponse(subject, body)
                    };
                }
            } catch (error) {
                console.error('Gemini AI error:', error);
            }
            
            // Fallback
            return {
                priorityScore: analyzePriority(subject, body),
                mood: analyzeMood(subject + ' ' + body),
                summary: body.substring(0, 100) + '...',
                draftResponse: generateResponse(subject, body)
            };
        }

        function openAddEmailModal() {
            document.getElementById('add-email-modal').classList.add('active');
        }

        function closeAddEmailModal() {
            document.getElementById('add-email-modal').classList.remove('active');
            document.getElementById('email-form').reset();
        }

        function analyzeMood(text) {
            const lower = text.toLowerCase();
            if (lower.includes('urgent') || lower.includes('asap') || lower.includes('critical') || lower.includes('immediately')) return 'Stressed';
            if (lower.includes('angry') || lower.includes('disappointed') || lower.includes('complaint') || lower.includes('furious') || lower.includes('unacceptable')) return 'Concerned';
            if (lower.includes('thank') || lower.includes('appreciate') || lower.includes('great') || lower.includes('excellent')) return 'Happy';
            if (lower.includes('?')) return 'Neutral';
            return 'Formal';
        }

        function analyzePriority(subject, body) {
            let score = 0;
            const text = (subject + ' ' + body).toLowerCase();
            
            if (text.includes('urgent') || text.includes('asap')) score += 5;
            if (text.includes('critical') || text.includes('emergency')) score += 4;
            if (text.includes('deadline') || text.includes('immediately')) score += 4;
            if (text.includes('important') || text.includes('priority')) score += 3;
            if (text.includes('meeting') || text.includes('call')) score += 2;
            if (text.includes('investment') || text.includes('partnership') || text.includes('opportunity')) score += 5;
            if (text.includes('customer') || text.includes('complaint') || text.includes('issue') || text.includes('problem')) score += 4;
            if (text.includes('angry') || text.includes('disappointed') || text.includes('furious')) score += 4;
            if (text.includes('refund') || text.includes('broken') || text.includes('bug')) score += 3;

            if (userInterests) {
                const interests = userInterests.toLowerCase().split(',');
                interests.forEach(interest => {
                    if (text.includes(interest.trim())) score += 4;
                });
            }

            return Math.min(Math.max(score, 1), 10);
        }

        function generateResponse(subject, body) {
            const lower = (subject + ' ' + body).toLowerCase();
            
            if (lower.includes('meeting') || lower.includes('call') || lower.includes('schedule')) {
                return 'Thank you for reaching out. I appreciate you taking the time to connect. I would be happy to schedule a meeting at your convenience. Please let me know what times work best for you.';
            }
            if (lower.includes('investment') || lower.includes('partnership') || lower.includes('opportunity')) {
                return 'Thank you for this exciting opportunity. I am very interested in exploring potential collaboration. I would love to discuss this further and learn more about your proposal.';
            }
            if (lower.includes('refund') || lower.includes('complaint') || lower.includes('issue') || lower.includes('problem')) {
                return 'I sincerely apologize for the inconvenience you have experienced. Your satisfaction is very important to us. Please let me know how I can help resolve this matter promptly.';
            }
            if (lower.includes('thank') || lower.includes('appreciate')) {
                return 'Thank you so much for your kind words. It was a pleasure working with you. I look forward to future collaborations.';
            }
            return 'Thank you for your email. I have received your message and will review it carefully. I will get back to you as soon as possible.';
        }

        async function addEmail() {
            event.preventDefault();
            const from = document.getElementById('email-from').value;
            const subject = document.getElementById('email-subject').value;
            const body = document.getElementById('email-body').value;

            if (!from || !subject || !body) {
                alert('Please fill all fields');
                return;
            }

            // Use AI analysis if available
            const analysis = await analyzeEmailWithAI(subject, body, from);

            const newEmail = {
                id: Date.now(),
                from: from,
                subject: subject,
                body: body,
                received: new Date().toLocaleTimeString(),
                analysis: analysis
            };

            emails.push(newEmail);
            emails.sort((a, b) => b.analysis.priorityScore - a.analysis.priorityScore);

            closeAddEmailModal();
            renderEmails();
            selectEmail(newEmail.id);
        }

        function renderEmails() {
            const container = document.getElementById('email-list-container');
            const placeholder = document.getElementById('email-list-placeholder');
            container.innerHTML = '';

            if (emails.length === 0) {
                placeholder.style.display = 'block';
                return;
            }
            placeholder.style.display = 'none';

            emails.forEach(email => {
                const isActive = selectedEmail && selectedEmail.id === email.id;
                const card = document.createElement('div');
                card.className = `p-3 rounded-xl cursor-pointer transition duration-200 border ${isActive ? 'bg-blue-600 border-blue-500' : 'bg-gray-700 hover:bg-gray-600 border-gray-700'}`;
                card.innerHTML = `
                    <div class="flex justify-between items-center text-sm font-semibold mb-1">
                        <span class="truncate">${email.subject}</span>
                        <span class="text-xs font-normal ${isActive ? 'text-blue-200' : 'text-gray-400'}">${email.received}</span>
                    </div>
                    <div class="flex justify-between items-center text-xs text-gray-300">
                        <span class="truncate">From: ${email.from}</span>
                        <div class="flex items-center space-x-2">
                            <span class="font-medium text-yellow-400">P:${email.analysis.priorityScore}</span>
                            <span class="font-medium ${email.analysis.mood === 'Stressed' ? 'text-red-400' : email.analysis.mood === 'Happy' ? 'text-green-400' : email.analysis.mood === 'Concerned' ? 'text-orange-400' : 'text-gray-400'}">${email.analysis.mood}</span>
                        </div>
                    </div>
                `;
                card.onclick = () => selectEmail(email.id);
                container.appendChild(card);
            });
            document.getElementById('email-count').textContent = `Emails (${emails.length})`;
        }

        function selectEmail(id) {
            selectedEmail = emails.find(e => e.id === id);
            renderEmails();
            const viewer = document.getElementById('email-viewer-container');
            const empty = document.getElementById('email-viewer-empty');

            if (!selectedEmail) {
                empty.style.display = 'flex';
                viewer.innerHTML = '';
                return;
            }

            empty.style.display = 'none';
            viewer.innerHTML = `
                <div class="flex justify-between items-center pb-4 border-b border-gray-700 mb-6">
                    <h2 class="text-3xl font-bold text-white">${selectedEmail.subject}</h2>
                    <span class="text-sm text-gray-400">Received: ${selectedEmail.received}</span>
                </div>
                <div class="text-gray-300 mb-6">
                    <span class="font-semibold text-blue-400">From:</span> ${selectedEmail.from}
                </div>
                <div class="bg-gray-800 p-6 rounded-xl mb-8 border border-yellow-500/50">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-400">⚡ AI Manager Analysis</h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="p-3 bg-gray-900 rounded-lg">
                            <span class="text-xs text-gray-400 block">Priority Score</span>
                            <span class="text-2xl font-extrabold text-red-500">${selectedEmail.analysis.priorityScore}/10</span>
                        </div>
                        <div class="p-3 bg-gray-900 rounded-lg">
                            <span class="text-xs text-gray-400 block">Sender Mood</span>
                            <span class="text-2xl font-extrabold text-green-400">${selectedEmail.analysis.mood}</span>
                        </div>
                    </div>
                    <h4 class="text-lg font-semibold text-blue-400 mt-4 mb-2">Draft Response</h4>
                    <textarea id="draft-response" rows="4" class="w-full p-3 bg-gray-700 rounded-lg text-white resize-none">${selectedEmail.analysis.draftResponse}</textarea>
                    <button onclick="document.getElementById('draft-response').select(); document.execCommand('copy');" class="mt-3 bg-indigo-600 hover:bg-indigo-500 text-white py-2 px-4 rounded-full text-sm transition duration-300">
                        📋 Copy Draft
                    </button>
                </div>
                <div class="mt-6 border-t border-gray-700 pt-6">
                    <h3 class="text-xl font-semibold mb-3 text-white">Original Email Content</h3>
                    <p class="text-gray-400 whitespace-pre-wrap">${selectedEmail.body}</p>
                </div>
            `;
        }

        // Load saved API config on startup
        document.addEventListener('DOMContentLoaded', () => {
            const savedClientId = localStorage.getItem('gmail_client_id');
            const savedGeminiKey = localStorage.getItem('gemini_api_key');
            
            if (savedClientId && savedGeminiKey) {
                CLIENT_ID = savedClientId;
                GEMINI_API_KEY = savedGeminiKey;
                document.getElementById('client-id-input').value = savedClientId;
                document.getElementById('gemini-key-input').value = savedGeminiKey;
            }
            
            showScreen('welcome-screen');
        });
    </script>

    <!-- WELCOME SCREEN -->
    <div id="welcome-screen" class="screen active flex-col items-center justify-start pt-16 px-4">
       <header class="text-center mb-10 max-w-xl">
    <div class="text-5xl font-extrabold text-blue-400 mb-2">⚡</div>
    <h1 class="text-5xl font-bold mb-4">AI Email Manager</h1>
    <p class="text-gray-400 text-xl">Your smart assistant that helps you respond to emails faster with AI-powered suggestions.</p>
</header>

        <!-- HOW IT WORKS -->
<div class="max-w-4xl w-full mb-12 bg-gray-900 p-8 rounded-2xl border border-gray-700">
    <h2 class="text-3xl font-bold text-center mb-8 text-yellow-400">How It Works (3 Simple Steps)</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="text-center">
            <div class="text-5xl mb-4">📧</div>
            <div class="bg-blue-600 text-white font-bold rounded-full w-8 h-8 flex items-center justify-center mx-auto mb-3">1</div>
            <h3 class="text-lg font-bold mb-2">Paste Your Email</h3>
            <p class="text-gray-400 text-sm">Copy any email from your inbox and paste it into the app</p>
        </div>
        
        <div class="text-center">
            <div class="text-5xl mb-4">🤖</div>
            <div class="bg-blue-600 text-white font-bold rounded-full w-8 h-8 flex items-center justify-center mx-auto mb-3">2</div>
            <h3 class="text-lg font-bold mb-2">AI Analyzes</h3>
            <p class="text-gray-400 text-sm">Instant priority score (1-10), mood detection, and smart insights</p>
        </div>
        
        <div class="text-center">
            <div class="text-5xl mb-4">✅</div>
            <div class="bg-blue-600 text-white font-bold rounded-full w-8 h-8 flex items-center justify-center mx-auto mb-3">3</div>
            <h3 class="text-lg font-bold mb-2">Copy & Send</h3>
            <p class="text-gray-400 text-sm">Get professional response draft in seconds, copy and send</p>
        </div>
    </div>
</div>

<!-- COMING SOON -->
<div class="max-w-3xl w-full mb-12 bg-gradient-to-r from-purple-900 to-blue-900 p-6 rounded-xl border-2 border-purple-500">
    <div class="flex items-center justify-center mb-3">
        <span class="bg-green-500 text-gray-900 text-xs font-bold px-3 py-1 rounded-full">✅ NOW AVAILABLE!</span>
    </div>
    <h3 class="text-2xl font-bold text-center mb-4">🚀 Powered by Real AI</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <div class="flex items-start space-x-3">
            <span class="text-2xl">🧠</span>
            <div>
                <div class="font-semibold text-green-400">Google Gemini AI</div>
                <div class="text-gray-300">Real AI-powered analysis and response generation</div>
            </div>
        </div>
        <div class="flex items-start space-x-3">
            <span class="text-2xl">📬</span>
            <div>
                <div class="font-semibold text-green-400">Gmail Integration</div>
                <div class="text-gray-300">Connect your Gmail for automatic email fetching</div>
            </div>
        </div>
    </div>
</div>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-6 mb-12 max-w-3xl w-full">
            <div class="flex flex-col items-center p-4 bg-gray-800 rounded-xl shadow-lg hover:bg-gray-700 transition duration-300">
                <div class="text-3xl mb-1 text-yellow-400">📧</div>
                <div class="font-semibold text-sm text-center">Add Your Emails</div>
                <div class="text-xs text-gray-400 text-center">Paste any email for instant analysis</div>
            </div>
            <div class="flex flex-col items-center p-4 bg-gray-800 rounded-xl shadow-lg hover:bg-gray-700 transition duration-300">
                <div class="text-3xl mb-1 text-green-400">😊</div>
                <div class="font-semibold text-sm text-center">Mood Detection</div>
                <div class="text-xs text-gray-400 text-center">See sender's mood</div>
            </div>
            <div class="flex flex-col items-center p-4 bg-gray-800 rounded-xl shadow-lg hover:bg-gray-700 transition duration-300">
                <div class="text-3xl mb-1 text-red-400">🎯</div>
                <div class="font-semibold text-sm text-center">Smart Priority</div>
                <div class="text-xs text-gray-400 text-center">AI scores 1-10</div>
            </div>
            <div class="flex flex-col items-center p-4 bg-gray-800 rounded-xl shadow-lg hover:bg-gray-700 transition duration-300">
                <div class="text-3xl mb-1 text-blue-400">💬</div>
                <div class="font-semibold text-sm text-center">AI Responses</div>
                <div class="text-xs text-gray-400 text-center">Get reply drafts</div>
            </div>
        </div>

        <!-- ABOUT & PRIVACY SECTION -->
        <div class="max-w-4xl w-full mb-12 bg-gray-900 p-8 rounded-2xl border border-green-500">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-green-400 mb-3">🔒 Your Privacy is Our Priority</h2>
                <p class="text-gray-400">We built this tool with security and transparency in mind</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-800 p-5 rounded-xl border border-gray-700">
                    <div class="text-3xl mb-3">🌐</div>
                    <h3 class="text-lg font-bold text-white mb-2">100% Browser-Based</h3>
                    <p class="text-sm text-gray-400">All email processing happens in YOUR browser. We have no servers, no databases - nothing is uploaded or stored anywhere.</p>
                </div>
                
                <div class="bg-gray-800 p-5 rounded-xl border border-gray-700">
                    <div class="text-3xl mb-3">🚫</div>
                    <h3 class="text-lg font-bold text-white mb-2">Zero Data Collection</h3>
                    <p class="text-sm text-gray-400">We never see, store, or transmit your emails. Your data stays with you. We can't access it even if we wanted to.</p>
                </div>
                
                <div class="bg-gray-800 p-5 rounded-xl border border-gray-700">
                    <div class="text-3xl mb-3">🛡️</div>
                    <h3 class="text-lg font-bold text-white mb-2">Sensitive Content Filtered</h3>
                    <p class="text-sm text-gray-400">OTPs, banking emails, passwords, and verification codes are automatically filtered out. You control what gets analyzed.</p>
                </div>
                
                <div class="bg-gray-800 p-5 rounded-xl border border-gray-700">
                    <div class="text-3xl mb-3">🔐</div>
                    <h3 class="text-lg font-bold text-white mb-2">Official APIs Only</h3>
                    <p class="text-sm text-gray-400">Direct secure connection to Google & Gemini APIs. No third parties, no middlemen, fully encrypted.</p>
                </div>
            </div>
            
            <div class="bg-blue-900/30 border border-blue-500 rounded-lg p-5 text-center">
                <p class="text-sm text-gray-300">
                    <strong class="text-blue-400">How it works:</strong> When you connect Gmail, your browser fetches emails directly from Google using OAuth (the same secure method used by official apps). The AI analysis happens in your browser using Google's Gemini API. <strong class="text-white">Nothing passes through our servers because we don't have any!</strong>
                </p>
                <p class="text-xs text-gray-400 mt-3">
                    Open source coming soon - you'll be able to inspect every line of code yourself!
                </p>
            </div>
        </div>

        <div class="flex gap-4">
            <button onclick="setupAPIs()" class="bg-green-500 hover:bg-green-400 text-gray-900 font-bold py-3 px-8 rounded-full text-lg shadow-2xl transform hover:scale-105 transition duration-300">
                🔗 Connect Gmail + AI
            </button>
            <button onclick="startCustomization()" class="bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full text-lg shadow-2xl transform hover:scale-105 transition duration-300">
                🚀 Try Without API
            </button>
        </div>
        
        <p class="text-gray-500 text-sm mt-8 max-w-2xl text-center">
            By using this tool, you acknowledge that you understand how your data is processed. You can disconnect anytime and revoke access from your Google Account settings.
        </p>
    </div>

    <!-- NEW: API SETUP SCREEN -->
    <div id="api-setup-screen" class="screen flex-col items-center justify-center p-4">
        <div class="max-w-2xl w-full bg-gray-900 p-8 rounded-2xl shadow-2xl border-t-4 border-green-500">
            <h2 class="text-3xl font-bold text-green-400 mb-4 text-center">🔐 Setup API Credentials</h2>
            <p class="text-gray-400 text-center mb-8">Enter your FREE API keys to unlock Gmail integration and AI-powered analysis</p>
            
            <div class="space-y-6">
                <div>
                    <label for="client-id-input" class="block text-sm font-medium text-gray-300 mb-2">Google OAuth Client ID</label>
                    <input type="text" id="client-id-input" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500" placeholder="Your Google Cloud OAuth Client ID">
                    <p class="text-xs text-gray-500 mt-1">Get from <a href="https://console.cloud.google.com/" target="_blank" class="text-blue-400 hover:underline">Google Cloud Console</a></p>
                </div>
                
                <div>
                    <label for="gemini-key-input" class="block text-sm font-medium text-gray-300 mb-2">Gemini API Key</label>
                    <input type="text" id="gemini-key-input" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500" placeholder="Your Google AI Studio API Key">
                    <p class="text-xs text-gray-500 mt-1">Get from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-400 hover:underline">Google AI Studio</a> (Free: 1,500 requests/day)</p>
                </div>
            </div>

            <div class="mt-8 bg-blue-900/30 border border-blue-500 rounded-lg p-4">
                <h3 class="font-semibold text-blue-400 mb-2">📋 Quick Setup Guide:</h3>
                <ol class="text-sm text-gray-300 space-y-2 list-decimal list-inside">
                    <li>Create project in <a href="https://console.cloud.google.com/" target="_blank" class="text-blue-400 hover:underline">Google Cloud Console</a></li>
                    <li>Enable Gmail API</li>
                    <li>Create OAuth 2.0 Client ID (Web application)</li>
                    <li>Add redirect URI: <code class="bg-gray-800 px-2 py-1 rounded text-xs">https://rahul810-koder.github.io/ai-email-manager/</code></li>
                    <li>Get Gemini key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-400 hover:underline">AI Studio</a></li>
                </ol>
            </div>

            <div class="mt-8 flex justify-between">
                <button onclick="saveAPIConfig()" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-6 rounded-full">
                    ✅ Save & Continue
                </button>
                <button onclick="skipAPISetup()" class="text-gray-400 hover:text-white font-medium py-3 px-6">
                    Skip (Use Demo Mode)
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: PRIVACY & PERMISSIONS SCREEN -->
    <div id="privacy-screen" class="screen flex-col items-center justify-center p-4">
        <div class="max-w-3xl w-full bg-gray-900 p-8 rounded-2xl shadow-2xl border-t-4 border-green-500">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">🔒</div>
                <h2 class="text-3xl font-bold text-green-400 mb-4">Your Privacy Matters</h2>
                <p class="text-gray-400">Before connecting Gmail, please review what we access and how we protect your data</p>
            </div>

            <div class="bg-gray-800 p-6 rounded-xl mb-6 border border-green-500/30">
                <h3 class="text-xl font-semibold text-green-400 mb-4">✅ What We Access</h3>
                <div class="space-y-3 text-sm text-gray-300">
                    <div class="flex items-start space-x-3">
                        <span class="text-green-400 mt-1">✓</span>
                        <div>
                            <strong>Email Subjects</strong> - To show you what's in your inbox
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-green-400 mt-1">✓</span>
                        <div>
                            <strong>Sender Information</strong> - To identify who sent the email
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-green-400 mt-1">✓</span>
                        <div>
                            <strong>Email Content (selected by you)</strong> - Only emails you choose to analyze
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-red-900/20 p-6 rounded-xl mb-6 border border-red-500/30">
                <h3 class="text-xl font-semibold text-red-400 mb-4">🚫 What We NEVER Access</h3>
                <div class="space-y-3 text-sm text-gray-300">
                    <div class="flex items-start space-x-3">
                        <span class="text-red-400 mt-1">✗</span>
                        <div>
                            <strong>OTP / Verification Codes</strong> - Automatically filtered out
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-red-400 mt-1">✗</span>
                        <div>
                            <strong>Banking & Financial Emails</strong> - Skipped by default
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-red-400 mt-1">✗</span>
                        <div>
                            <strong>Password Reset Emails</strong> - Automatically excluded
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-red-400 mt-1">✗</span>
                        <div>
                            <strong>Personal/Sensitive Content</strong> - You control what gets analyzed
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-blue-900/20 p-6 rounded-xl mb-6 border border-blue-500/30">
                <h3 class="text-xl font-semibold text-blue-400 mb-4">🛡️ How We Protect You</h3>
                <div class="space-y-3 text-sm text-gray-300">
                    <div class="flex items-start space-x-3">
                        <span class="text-blue-400 mt-1">•</span>
                        <div>
                            <strong>100% Browser-Based</strong> - All processing happens in YOUR browser, not our servers
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-blue-400 mt-1">•</span>
                        <div>
                            <strong>No Data Storage</strong> - We never store, save, or transmit your emails anywhere
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-blue-400 mt-1">•</span>
                        <div>
                            <strong>Official APIs Only</strong> - Direct connection to Google & Gemini (secure & encrypted)
                        </div>
                    </div>
                    <div class="flex items-start space-x-3">
                        <span class="text-blue-400 mt-1">•</span>
                        <div>
                            <strong>You Control Everything</strong> - Disconnect anytime, choose which emails to analyze
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-yellow-900/20 p-6 rounded-xl mb-6 border border-yellow-500/30">
                <h3 class="text-lg font-semibold text-yellow-400 mb-3">📋 Choose What to Fetch</h3>
                <div class="space-y-3">
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="radio" name="fetch-mode" value="safe" checked class="w-4 h-4">
                        <div>
                            <div class="font-semibold text-white">Safe Mode (Recommended)</div>
                            <div class="text-xs text-gray-400">Skip OTP, banking, passwords, verification emails</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="radio" name="fetch-mode" value="work" class="w-4 h-4">
                        <div>
                            <div class="font-semibold text-white">Work Emails Only</div>
                            <div class="text-xs text-gray-400">Only fetch work-related emails (no personal)</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="radio" name="fetch-mode" value="manual" class="w-4 h-4">
                        <div>
                            <div class="font-semibold text-white">Manual Selection</div>
                            <div class="text-xs text-gray-400">I'll manually choose which emails to analyze</div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="bg-gray-800 p-4 rounded-lg mb-6 text-xs text-gray-400 text-center">
                By continuing, you agree that you understand and accept these privacy measures. You can revoke access anytime.
            </div>

            <div class="flex justify-between">
                <button onclick="acceptPrivacyAndConnect()" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transform hover:scale-105 transition duration-300">
                    ✅ I Understand, Continue
                </button>
                <button onclick="skipAPISetup()" class="text-gray-400 hover:text-white font-medium py-3 px-6">
                    ← Go Back
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: GMAIL CONNECT SCREEN -->
    <div id="gmail-connect-screen" class="screen flex-col items-center justify-center p-4">
        <div class="max-w-xl w-full bg-gray-900 p-8 rounded-2xl shadow-2xl border-t-4 border-blue-500 text-center">
            <div class="text-6xl mb-4">📧</div>
            <h2 class="text-3xl font-bold text-blue-400 mb-4">Connect Your Gmail</h2>
            <p class="text-gray-400 mb-8">Click below to securely connect your Gmail account and start analyzing emails with AI</p>
            
            <button onclick="connectGmail()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-8 rounded-full text-lg shadow-lg transform hover:scale-105 transition duration-300">
                🔐 Connect Gmail Account
            </button>
            
            <div class="mt-6">
                <button onclick="skipAPISetup()" class="text-gray-400 hover:text-white font-medium">
                    Skip for now
                </button>
            </div>
        </div>
    </div>

    <!-- CUSTOMIZATION SCREEN -->
    <div id="customization-screen" class="screen flex-col items-center justify-center p-4">
        <div class="max-w-xl w-full bg-gray-900 p-8 rounded-2xl shadow-2xl border-t-4 border-yellow-500">
            <h2 class="text-3xl font-bold text-yellow-400 mb-4 text-center">🎯 Customize Your Experience</h2>
            <p class="text-gray-400 text-center mb-8">Tell us about yourself so we can personalize AI suggestions.</p>
            
            <div class="space-y-6">
                <div>
                    <label for="interests" class="block text-sm font-medium text-gray-300 mb-2">Your Main Interests</label>
                    <input type="text" id="interests" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500" placeholder="e.g., Finance, Tech, Marketing">
                </div>
                
                <div>
                    <label for="schedule" class="block text-sm font-medium text-gray-300 mb-2">Your Schedule</label>
                    <textarea id="schedule" rows="3" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500" placeholder="e.g., Available 9 AM - 5 PM EST"></textarea>
                </div>
            </div>

            <div class="mt-8 flex justify-between">
                <button onclick="continueToInbox()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-full">
                    Continue to Inbox
                </button>
                <button onclick="continueToInbox()" class="text-gray-400 hover:text-white font-medium py-3 px-6">
                    Skip for now
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN APP SCREEN -->
    <div id="main-app-screen" class="screen">
        <div class="flex h-screen w-screen">
            <div class="w-1/4 min-w-[300px] bg-gray-800 border-r border-gray-700 p-4 flex flex-col">
                <header class="mb-6">
                    <h1 class="text-2xl font-bold text-blue-400">AI Email Manager</h1>
                    <p class="text-xs text-gray-400 mt-1" id="api-status">Demo Mode</p>
                    <div class="mt-3 bg-green-900/30 border border-green-500/50 rounded-lg p-2 text-xs text-green-400" id="privacy-badge" style="display: none;">
                        🔒 Privacy Protected - Sensitive emails filtered
                    </div>
                </header>

                <h2 class="text-lg font-semibold mb-3" id="email-count">Emails (0)</h2>

                <button onclick="openAddEmailModal()" class="bg-green-600 hover:bg-green-500 text-white font-semibold py-2 rounded-lg mb-4">
                    ➕ Add Email
                </button>

                <div class="flex-grow overflow-y-auto space-y-2" id="email-list-container"></div>

                <div class="bg-gray-700 p-4 rounded-lg text-center text-gray-400 mt-4" id="email-list-placeholder">
                    <span class="text-3xl block mb-2">📭</span>
                    No emails yet
                </div>
            </div>

            <div class="flex-grow bg-gray-900 p-8 flex flex-col overflow-y-auto">
                <div id="email-viewer-container"></div>
                <div id="email-viewer-empty" class="text-center text-gray-400 h-full flex flex-col justify-center items-center">
                    <span class="text-6xl block mb-4">📧</span>
                    <h2 class="text-xl font-semibold mb-2">No email selected</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD EMAIL MODAL -->
    <div id="add-email-modal" class="modal-overlay">
        <div class="bg-gray-800 p-8 rounded-xl w-full max-w-lg shadow-2xl border-t-4 border-blue-500">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-blue-400">➕ Add New Email</h3>
                <button onclick="closeAddEmailModal()" class="text-gray-400 hover:text-white text-xl">×</button>
            </div>

            <form id="email-form" onsubmit="addEmail()">
                <div class="mb-4">
                    <label for="email-from" class="block text-sm font-medium text-gray-300 mb-2">From</label>
                    <input type="email" id="email-from" required class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white">
                </div>

                <div class="mb-4">
                    <label for="email-subject" class="block text-sm font-medium text-gray-300 mb-2">Subject</label>
                    <input type="text" id="email-subject" required class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white">
                </div>

                <div class="mb-6">
                    <label for="email-body" class="block text-sm font-medium text-gray-300 mb-2">Email Body</label>
                    <textarea id="email-body" rows="6" required class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white"></textarea>
                </div>

                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeAddEmailModal()" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-full">
                        Cancel
                    </button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-full">
                        ✅ Add Email
                    </button>
                </div>
            </form>
        </div>
    </div>
    <!-- Theme Toggle Button (Fixed Position) -->
<button id="theme-toggle-btn" class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
    ☀️
</button>
</body>
</html>
